SELECT * FROM (
SELECT gid,
CASE
	WHEN startdist = 0 THEN enddist ELSE startdist
END AS neardist FROM (
SELECT mt.gid,
MIN(ST_Distance(mt.lstart, nt.geom)) AS startdist,
MIN(ST_Distance(mt.lend, nt.geom)) AS enddist
FROM teste2 AS mt, (
	SELECT ROW_NUMBER() OVER (ORDER BY txtgeom) AS idpnt, txtgeom, npnt,
	ST_GeomFromText(txtgeom, 3763) AS geom
FROM (
	SELECT txtgeom, COUNT(txtgeom) AS npnt FROM (
		SELECT pstart AS txtgeom
		FROM (
			SELECT gid, geom, 
			ST_AsText(ST_StartPoint(geom)) AS pstart,
			ST_AsText(ST_EndPoint(geom)) AS pend
			FROM (
				SELECT gid, (ST_Dump(geom)).geom AS geom
				FROM hidrolinhas
			) AS foo
		) AS ta
		UNION ALL
		SELECT pend AS txtgeom
		FROM (
			SELECT gid, geom, 
			ST_AsText(ST_StartPoint(geom)) AS pstart,
			ST_AsText(ST_EndPoint(geom)) AS pend
			FROM (
				SELECT gid, (ST_Dump(geom)).geom AS geom
				FROM hidrolinhas
			) AS foo
		) AS tb
	) AS tbl
	GROUP BY txtgeom
) AS cntpnt
) AS nt
WHERE (mt.nstart = 1 AND mt.nend IS NULL AND mt.pstart <> nt.txtgeom)
OR (mt.nstart IS NULL AND mt.nend = 1 AND mt.pend <> nt.txtgeom)
GROUP BY gid) AS foo) AS coco WHERE neardist < 50